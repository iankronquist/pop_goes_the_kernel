#include "idt.h"
#include "gdt.h"
#include "vga_driver.h"

//void generic_interrupt(struct cpu_state cpu, struct stack_state stack,
//                       unsigned int interrupt) {
//void generic_interrupt(struct registers regs, unsigned int interrupt) {
void generic_interrupt(struct registers regs, unsigned int interrupt) {
//void generic_interrupt(unsigned int interrupt) {
    vga_putstr("Interrupt caught!");
}

void setup_idt() {
    __asm__ volatile ("cli");
    idtp.limit = (sizeof(struct idt_entry) * NUM_IDT_ENTRIES) - 1;
    idtp.base = (uintptr_t)&idtp;
    set_interrupts();
    load_idt();
    __asm__ volatile ("sti");
}
void idt_set_gate(unsigned char entry, void (*interrupt_base)(void),
                  unsigned short selector, unsigned char flags) {
    idt[entry].base_low = (uintptr_t)interrupt_base & 0xffff;
    idt[entry].base_high = ((uintptr_t)interrupt_base >> 16) & 0xffff;
    idt[entry].selector = selector;
    idt[entry].zero = 0;
    idt[entry].flags = flags | 0x60;
}

void set_interrupts() {
    idt_set_gate(0, no_error_code_interrupt_handler_0, 0x08, 0x8e);
    idt_set_gate(1, no_error_code_interrupt_handler_1, 0x08, 0x8e);
    idt_set_gate(2, no_error_code_interrupt_handler_2, 0x08, 0x8e);
    idt_set_gate(3, no_error_code_interrupt_handler_3, 0x08, 0x8e);
    idt_set_gate(4, no_error_code_interrupt_handler_4, 0x08, 0x8e);
    idt_set_gate(5, no_error_code_interrupt_handler_5, 0x08, 0x8e);
    idt_set_gate(6, no_error_code_interrupt_handler_6, 0x08, 0x8e);
    idt_set_gate(7, interrupt_handler_7, 0x08, 0x8e);
    idt_set_gate(8, interrupt_handler_8, 0x08, 0x8e);
    idt_set_gate(9, interrupt_handler_9, 0x08, 0x8e);
    idt_set_gate(10, interrupt_handler_10, 0x08, 0x8e);
    idt_set_gate(11, interrupt_handler_11, 0x08, 0x8e);
    idt_set_gate(12, interrupt_handler_12, 0x08, 0x8e);
    idt_set_gate(13, interrupt_handler_13, 0x08, 0x8e);
    idt_set_gate(14, interrupt_handler_14, 0x08, 0x8e);
    idt_set_gate(15, interrupt_handler_15, 0x08, 0x8e);
    idt_set_gate(16, interrupt_handler_16, 0x08, 0x8e);
    idt_set_gate(17, interrupt_handler_17, 0x08, 0x8e);
    idt_set_gate(18, interrupt_handler_18, 0x08, 0x8e);
    idt_set_gate(19, interrupt_handler_19, 0x08, 0x8e);
    idt_set_gate(20, interrupt_handler_20, 0x08, 0x8e);
    idt_set_gate(21, interrupt_handler_21, 0x08, 0x8e);
    idt_set_gate(22, interrupt_handler_22, 0x08, 0x8e);
    idt_set_gate(23, interrupt_handler_23, 0x08, 0x8e);
    idt_set_gate(24, interrupt_handler_24, 0x08, 0x8e);
    idt_set_gate(25, interrupt_handler_25, 0x08, 0x8e);
    idt_set_gate(26, interrupt_handler_26, 0x08, 0x8e);
    idt_set_gate(27, interrupt_handler_27, 0x08, 0x8e);
    idt_set_gate(28, interrupt_handler_28, 0x08, 0x8e);
    idt_set_gate(29, interrupt_handler_29, 0x08, 0x8e);
    idt_set_gate(30, interrupt_handler_30, 0x08, 0x8e);
    idt_set_gate(31, interrupt_handler_31, 0x08, 0x8e);
    idt_set_gate(32, interrupt_handler_32, 0x08, 0x8e);
    idt_set_gate(33, interrupt_handler_33, 0x08, 0x8e);
    idt_set_gate(34, interrupt_handler_34, 0x08, 0x8e);
    idt_set_gate(35, interrupt_handler_35, 0x08, 0x8e);
    idt_set_gate(36, interrupt_handler_36, 0x08, 0x8e);
    idt_set_gate(37, interrupt_handler_37, 0x08, 0x8e);
    idt_set_gate(38, interrupt_handler_38, 0x08, 0x8e);
    idt_set_gate(39, interrupt_handler_39, 0x08, 0x8e);
    idt_set_gate(40, interrupt_handler_40, 0x08, 0x8e);
    idt_set_gate(41, interrupt_handler_41, 0x08, 0x8e);
    idt_set_gate(42, interrupt_handler_42, 0x08, 0x8e);
    idt_set_gate(43, interrupt_handler_43, 0x08, 0x8e);
    idt_set_gate(44, interrupt_handler_44, 0x08, 0x8e);
    idt_set_gate(45, interrupt_handler_45, 0x08, 0x8e);
    idt_set_gate(46, interrupt_handler_46, 0x08, 0x8e);
    idt_set_gate(47, interrupt_handler_47, 0x08, 0x8e);
    idt_set_gate(48, interrupt_handler_48, 0x08, 0x8e);
    idt_set_gate(49, interrupt_handler_49, 0x08, 0x8e);
    idt_set_gate(50, interrupt_handler_50, 0x08, 0x8e);
    idt_set_gate(51, interrupt_handler_51, 0x08, 0x8e);
    idt_set_gate(52, interrupt_handler_52, 0x08, 0x8e);
    idt_set_gate(53, interrupt_handler_53, 0x08, 0x8e);
    idt_set_gate(54, interrupt_handler_54, 0x08, 0x8e);
    idt_set_gate(55, interrupt_handler_55, 0x08, 0x8e);
    idt_set_gate(56, interrupt_handler_56, 0x08, 0x8e);
    idt_set_gate(57, interrupt_handler_57, 0x08, 0x8e);
    idt_set_gate(58, interrupt_handler_58, 0x08, 0x8e);
    idt_set_gate(59, interrupt_handler_59, 0x08, 0x8e);
    idt_set_gate(60, interrupt_handler_60, 0x08, 0x8e);
    idt_set_gate(61, interrupt_handler_61, 0x08, 0x8e);
    idt_set_gate(62, interrupt_handler_62, 0x08, 0x8e);
    idt_set_gate(63, interrupt_handler_63, 0x08, 0x8e);
    idt_set_gate(64, interrupt_handler_64, 0x08, 0x8e);
    idt_set_gate(65, interrupt_handler_65, 0x08, 0x8e);
    idt_set_gate(66, interrupt_handler_66, 0x08, 0x8e);
    idt_set_gate(67, interrupt_handler_67, 0x08, 0x8e);
    idt_set_gate(68, interrupt_handler_68, 0x08, 0x8e);
    idt_set_gate(69, interrupt_handler_69, 0x08, 0x8e);
    idt_set_gate(70, interrupt_handler_70, 0x08, 0x8e);
    idt_set_gate(71, interrupt_handler_71, 0x08, 0x8e);
    idt_set_gate(72, interrupt_handler_72, 0x08, 0x8e);
    idt_set_gate(73, interrupt_handler_73, 0x08, 0x8e);
    idt_set_gate(74, interrupt_handler_74, 0x08, 0x8e);
    idt_set_gate(75, interrupt_handler_75, 0x08, 0x8e);
    idt_set_gate(76, interrupt_handler_76, 0x08, 0x8e);
    idt_set_gate(77, interrupt_handler_77, 0x08, 0x8e);
    idt_set_gate(78, interrupt_handler_78, 0x08, 0x8e);
    idt_set_gate(79, interrupt_handler_79, 0x08, 0x8e);
    idt_set_gate(80, interrupt_handler_80, 0x08, 0x8e);
    idt_set_gate(81, interrupt_handler_81, 0x08, 0x8e);
    idt_set_gate(82, interrupt_handler_82, 0x08, 0x8e);
    idt_set_gate(83, interrupt_handler_83, 0x08, 0x8e);
    idt_set_gate(84, interrupt_handler_84, 0x08, 0x8e);
    idt_set_gate(85, interrupt_handler_85, 0x08, 0x8e);
    idt_set_gate(86, interrupt_handler_86, 0x08, 0x8e);
    idt_set_gate(87, interrupt_handler_87, 0x08, 0x8e);
    idt_set_gate(88, interrupt_handler_88, 0x08, 0x8e);
    idt_set_gate(89, interrupt_handler_89, 0x08, 0x8e);
    idt_set_gate(90, interrupt_handler_90, 0x08, 0x8e);
    idt_set_gate(91, interrupt_handler_91, 0x08, 0x8e);
    idt_set_gate(92, interrupt_handler_92, 0x08, 0x8e);
    idt_set_gate(93, interrupt_handler_93, 0x08, 0x8e);
    idt_set_gate(94, interrupt_handler_94, 0x08, 0x8e);
    idt_set_gate(95, interrupt_handler_95, 0x08, 0x8e);
    idt_set_gate(96, interrupt_handler_96, 0x08, 0x8e);
    idt_set_gate(97, interrupt_handler_97, 0x08, 0x8e);
    idt_set_gate(98, interrupt_handler_98, 0x08, 0x8e);
    idt_set_gate(99, interrupt_handler_99, 0x08, 0x8e);
    idt_set_gate(100, interrupt_handler_100, 0x08, 0x8e);
    idt_set_gate(101, interrupt_handler_101, 0x08, 0x8e);
    idt_set_gate(102, interrupt_handler_102, 0x08, 0x8e);
    idt_set_gate(103, interrupt_handler_103, 0x08, 0x8e);
    idt_set_gate(104, interrupt_handler_104, 0x08, 0x8e);
    idt_set_gate(105, interrupt_handler_105, 0x08, 0x8e);
    idt_set_gate(106, interrupt_handler_106, 0x08, 0x8e);
    idt_set_gate(107, interrupt_handler_107, 0x08, 0x8e);
    idt_set_gate(108, interrupt_handler_108, 0x08, 0x8e);
    idt_set_gate(109, interrupt_handler_109, 0x08, 0x8e);
    idt_set_gate(110, interrupt_handler_110, 0x08, 0x8e);
    idt_set_gate(111, interrupt_handler_111, 0x08, 0x8e);
    idt_set_gate(112, interrupt_handler_112, 0x08, 0x8e);
    idt_set_gate(113, interrupt_handler_113, 0x08, 0x8e);
    idt_set_gate(114, interrupt_handler_114, 0x08, 0x8e);
    idt_set_gate(115, interrupt_handler_115, 0x08, 0x8e);
    idt_set_gate(116, interrupt_handler_116, 0x08, 0x8e);
    idt_set_gate(117, interrupt_handler_117, 0x08, 0x8e);
    idt_set_gate(118, interrupt_handler_118, 0x08, 0x8e);
    idt_set_gate(119, interrupt_handler_119, 0x08, 0x8e);
    idt_set_gate(120, interrupt_handler_120, 0x08, 0x8e);
    idt_set_gate(121, interrupt_handler_121, 0x08, 0x8e);
    idt_set_gate(122, interrupt_handler_122, 0x08, 0x8e);
    idt_set_gate(123, interrupt_handler_123, 0x08, 0x8e);
    idt_set_gate(124, interrupt_handler_124, 0x08, 0x8e);
    idt_set_gate(125, interrupt_handler_125, 0x08, 0x8e);
    idt_set_gate(126, interrupt_handler_126, 0x08, 0x8e);
    idt_set_gate(127, interrupt_handler_127, 0x08, 0x8e);
    idt_set_gate(128, interrupt_handler_128, 0x08, 0x8e);
    idt_set_gate(129, interrupt_handler_129, 0x08, 0x8e);
    idt_set_gate(130, interrupt_handler_130, 0x08, 0x8e);
    idt_set_gate(131, interrupt_handler_131, 0x08, 0x8e);
    idt_set_gate(132, interrupt_handler_132, 0x08, 0x8e);
    idt_set_gate(133, interrupt_handler_133, 0x08, 0x8e);
    idt_set_gate(134, interrupt_handler_134, 0x08, 0x8e);
    idt_set_gate(135, interrupt_handler_135, 0x08, 0x8e);
    idt_set_gate(136, interrupt_handler_136, 0x08, 0x8e);
    idt_set_gate(137, interrupt_handler_137, 0x08, 0x8e);
    idt_set_gate(138, interrupt_handler_138, 0x08, 0x8e);
    idt_set_gate(139, interrupt_handler_139, 0x08, 0x8e);
    idt_set_gate(140, interrupt_handler_140, 0x08, 0x8e);
    idt_set_gate(141, interrupt_handler_141, 0x08, 0x8e);
    idt_set_gate(142, interrupt_handler_142, 0x08, 0x8e);
    idt_set_gate(143, interrupt_handler_143, 0x08, 0x8e);
    idt_set_gate(144, interrupt_handler_144, 0x08, 0x8e);
    idt_set_gate(145, interrupt_handler_145, 0x08, 0x8e);
    idt_set_gate(146, interrupt_handler_146, 0x08, 0x8e);
    idt_set_gate(147, interrupt_handler_147, 0x08, 0x8e);
    idt_set_gate(148, interrupt_handler_148, 0x08, 0x8e);
    idt_set_gate(149, interrupt_handler_149, 0x08, 0x8e);
    idt_set_gate(150, interrupt_handler_150, 0x08, 0x8e);
    idt_set_gate(151, interrupt_handler_151, 0x08, 0x8e);
    idt_set_gate(152, interrupt_handler_152, 0x08, 0x8e);
    idt_set_gate(153, interrupt_handler_153, 0x08, 0x8e);
    idt_set_gate(154, interrupt_handler_154, 0x08, 0x8e);
    idt_set_gate(155, interrupt_handler_155, 0x08, 0x8e);
    idt_set_gate(156, interrupt_handler_156, 0x08, 0x8e);
    idt_set_gate(157, interrupt_handler_157, 0x08, 0x8e);
    idt_set_gate(158, interrupt_handler_158, 0x08, 0x8e);
    idt_set_gate(159, interrupt_handler_159, 0x08, 0x8e);
    idt_set_gate(160, interrupt_handler_160, 0x08, 0x8e);
    idt_set_gate(161, interrupt_handler_161, 0x08, 0x8e);
    idt_set_gate(162, interrupt_handler_162, 0x08, 0x8e);
    idt_set_gate(163, interrupt_handler_163, 0x08, 0x8e);
    idt_set_gate(164, interrupt_handler_164, 0x08, 0x8e);
    idt_set_gate(165, interrupt_handler_165, 0x08, 0x8e);
    idt_set_gate(166, interrupt_handler_166, 0x08, 0x8e);
    idt_set_gate(167, interrupt_handler_167, 0x08, 0x8e);
    idt_set_gate(168, interrupt_handler_168, 0x08, 0x8e);
    idt_set_gate(169, interrupt_handler_169, 0x08, 0x8e);
    idt_set_gate(170, interrupt_handler_170, 0x08, 0x8e);
    idt_set_gate(171, interrupt_handler_171, 0x08, 0x8e);
    idt_set_gate(172, interrupt_handler_172, 0x08, 0x8e);
    idt_set_gate(173, interrupt_handler_173, 0x08, 0x8e);
    idt_set_gate(174, interrupt_handler_174, 0x08, 0x8e);
    idt_set_gate(175, interrupt_handler_175, 0x08, 0x8e);
    idt_set_gate(176, interrupt_handler_176, 0x08, 0x8e);
    idt_set_gate(177, interrupt_handler_177, 0x08, 0x8e);
    idt_set_gate(178, interrupt_handler_178, 0x08, 0x8e);
    idt_set_gate(179, interrupt_handler_179, 0x08, 0x8e);
    idt_set_gate(180, interrupt_handler_180, 0x08, 0x8e);
    idt_set_gate(181, interrupt_handler_181, 0x08, 0x8e);
    idt_set_gate(182, interrupt_handler_182, 0x08, 0x8e);
    idt_set_gate(183, interrupt_handler_183, 0x08, 0x8e);
    idt_set_gate(184, interrupt_handler_184, 0x08, 0x8e);
    idt_set_gate(185, interrupt_handler_185, 0x08, 0x8e);
    idt_set_gate(186, interrupt_handler_186, 0x08, 0x8e);
    idt_set_gate(187, interrupt_handler_187, 0x08, 0x8e);
    idt_set_gate(188, interrupt_handler_188, 0x08, 0x8e);
    idt_set_gate(189, interrupt_handler_189, 0x08, 0x8e);
    idt_set_gate(190, interrupt_handler_190, 0x08, 0x8e);
    idt_set_gate(191, interrupt_handler_191, 0x08, 0x8e);
    idt_set_gate(192, interrupt_handler_192, 0x08, 0x8e);
    idt_set_gate(193, interrupt_handler_193, 0x08, 0x8e);
    idt_set_gate(194, interrupt_handler_194, 0x08, 0x8e);
    idt_set_gate(195, interrupt_handler_195, 0x08, 0x8e);
    idt_set_gate(196, interrupt_handler_196, 0x08, 0x8e);
    idt_set_gate(197, interrupt_handler_197, 0x08, 0x8e);
    idt_set_gate(198, interrupt_handler_198, 0x08, 0x8e);
    idt_set_gate(199, interrupt_handler_199, 0x08, 0x8e);
    idt_set_gate(200, interrupt_handler_200, 0x08, 0x8e);
    idt_set_gate(201, interrupt_handler_201, 0x08, 0x8e);
    idt_set_gate(202, interrupt_handler_202, 0x08, 0x8e);
    idt_set_gate(203, interrupt_handler_203, 0x08, 0x8e);
    idt_set_gate(204, interrupt_handler_204, 0x08, 0x8e);
    idt_set_gate(205, interrupt_handler_205, 0x08, 0x8e);
    idt_set_gate(206, interrupt_handler_206, 0x08, 0x8e);
    idt_set_gate(207, interrupt_handler_207, 0x08, 0x8e);
    idt_set_gate(208, interrupt_handler_208, 0x08, 0x8e);
    idt_set_gate(209, interrupt_handler_209, 0x08, 0x8e);
    idt_set_gate(210, interrupt_handler_210, 0x08, 0x8e);
    idt_set_gate(211, interrupt_handler_211, 0x08, 0x8e);
    idt_set_gate(212, interrupt_handler_212, 0x08, 0x8e);
    idt_set_gate(213, interrupt_handler_213, 0x08, 0x8e);
    idt_set_gate(214, interrupt_handler_214, 0x08, 0x8e);
    idt_set_gate(215, interrupt_handler_215, 0x08, 0x8e);
    idt_set_gate(216, interrupt_handler_216, 0x08, 0x8e);
    idt_set_gate(217, interrupt_handler_217, 0x08, 0x8e);
    idt_set_gate(218, interrupt_handler_218, 0x08, 0x8e);
    idt_set_gate(219, interrupt_handler_219, 0x08, 0x8e);
    idt_set_gate(220, interrupt_handler_220, 0x08, 0x8e);
    idt_set_gate(221, interrupt_handler_221, 0x08, 0x8e);
    idt_set_gate(222, interrupt_handler_222, 0x08, 0x8e);
    idt_set_gate(223, interrupt_handler_223, 0x08, 0x8e);
    idt_set_gate(224, interrupt_handler_224, 0x08, 0x8e);
    idt_set_gate(225, interrupt_handler_225, 0x08, 0x8e);
    idt_set_gate(226, interrupt_handler_226, 0x08, 0x8e);
    idt_set_gate(227, interrupt_handler_227, 0x08, 0x8e);
    idt_set_gate(228, interrupt_handler_228, 0x08, 0x8e);
    idt_set_gate(229, interrupt_handler_229, 0x08, 0x8e);
    idt_set_gate(230, interrupt_handler_230, 0x08, 0x8e);
    idt_set_gate(231, interrupt_handler_231, 0x08, 0x8e);
    idt_set_gate(232, interrupt_handler_232, 0x08, 0x8e);
    idt_set_gate(233, interrupt_handler_233, 0x08, 0x8e);
    idt_set_gate(234, interrupt_handler_234, 0x08, 0x8e);
    idt_set_gate(235, interrupt_handler_235, 0x08, 0x8e);
    idt_set_gate(236, interrupt_handler_236, 0x08, 0x8e);
    idt_set_gate(237, interrupt_handler_237, 0x08, 0x8e);
    idt_set_gate(238, interrupt_handler_238, 0x08, 0x8e);
    idt_set_gate(239, interrupt_handler_239, 0x08, 0x8e);
    idt_set_gate(240, interrupt_handler_240, 0x08, 0x8e);
    idt_set_gate(241, interrupt_handler_241, 0x08, 0x8e);
    idt_set_gate(242, interrupt_handler_242, 0x08, 0x8e);
    idt_set_gate(243, interrupt_handler_243, 0x08, 0x8e);
    idt_set_gate(244, interrupt_handler_244, 0x08, 0x8e);
    idt_set_gate(245, interrupt_handler_245, 0x08, 0x8e);
    idt_set_gate(246, interrupt_handler_246, 0x08, 0x8e);
    idt_set_gate(247, interrupt_handler_247, 0x08, 0x8e);
    idt_set_gate(248, interrupt_handler_248, 0x08, 0x8e);
    idt_set_gate(249, interrupt_handler_249, 0x08, 0x8e);
    idt_set_gate(250, interrupt_handler_250, 0x08, 0x8e);
    idt_set_gate(251, interrupt_handler_251, 0x08, 0x8e);
    idt_set_gate(252, interrupt_handler_252, 0x08, 0x8e);
    idt_set_gate(253, interrupt_handler_253, 0x08, 0x8e);
    idt_set_gate(254, interrupt_handler_254, 0x08, 0x8e);
    idt_set_gate(255, interrupt_handler_255, 0x08, 0x8e);
}
